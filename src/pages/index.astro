---
import { Image } from "astro:assets";
import distriktsSigill from './_index_assets/Distriktsigill_frilagt-3.png'
import templetUmea from './_index_assets/Umea_tempel.png'
import { getCollection, render, getEntry } from "astro:content";
import loadContentImage from "../utils/load-content-image";
import MainLayout from "../partials/main-layout.astro";
import LodgesGallery from "../partials/lodges-gallery.astro";
import "../styles/index.css";
import "../styles/homepage.css";

const vadArFrimureri = await getEntry('articles', 'vad-ar-frimureri');
const villDuBliFrimurare = await getEntry('articles', 'vill-du-bli-frimurare');
const mainTitle = vadArFrimureri?.data.title ?? '';
const sectionsData = await getCollection("frontPageSections");

const sections = await Promise.all(
  sectionsData.map(async (section) => {
    let linkUrl = null;
    let linkTitle = null;
    let imgLoader = null;

    const { Content } = await render(section);

    if (section.data.link) {
      const linked = await getEntry(section.data.link);
      linkUrl = `${import.meta.env.BASE_URL}/${linked.id}`;
      linkTitle = linked.data.title;
    }

    if (section.data.image) {
      imgLoader = loadContentImage(section.data.image);
    }

    return { Content, linkUrl, linkTitle, imgLoader };
  })
);

// Load lodge images
const solstavImage = loadContentImage("$images/solstav-scaled.jpg");
const manstavImage = loadContentImage("$images/Manstav.jpg");
const compassImage = loadContentImage("$images/solstav-scaled.jpg");
const moonImage = loadContentImage("$images/Manstav.jpg");
---
<MainLayout>
  <style>
    
    .hero-section {
      position: relative;
      width: 100%;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
    }
    .hero-background {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: 1;
    }
    .hero-content {
      position: relative;
      z-index: 2;
      text-align: center;
      color: white;
    }
    .hero-logo {
      width: 350px;
      height: 350px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
      object-fit: contain;
      margin-bottom: 2rem;
    }
    .hero-text h1 {
      font-size: 3rem;
      font-weight: bold;
      margin: 0;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
    }
    .hero-text h2 {
      font-size: 2rem;
      font-weight: 300;
      margin: 0.5rem 0 0 0;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
    }
    
    @media (max-width: 768px) {
      .hero-section {
        height: 100vh;
        min-height: 100vh;
        padding: 2rem 1rem;
      }
      
      .hero-logo {
        width: 250px;
        height: 250px;
        margin-bottom: 1.5rem;
      }
      
      .hero-text h1 {
        font-size: 2.2rem;
        line-height: 1.1;
        margin-bottom: 0.5rem;
      }
      
      .hero-text h2 {
        font-size: 1.4rem;
        font-weight: 400;
      }
      
      .welcome-section, .reflection-section {
        padding: 3rem 0;
      }
      
      .welcome-container, .reflection-container {
        flex-direction: column;
        gap: 2.5rem;
        padding: 0 1.5rem;
        max-width: 100%;
      }
      
      .welcome-content, .reflection-content {
        order: 2;
        text-align: center;
      }
      
      .welcome-image, .reflection-image {
        order: 1;
        width: 100%;
        max-width: 400px;
        margin: 0 auto;
      }
      
      .welcome-content h2, .reflection-content h2 {
        font-size: 2.2rem;
        margin-bottom: 1.5rem;
        text-align: center;
      }
      
      .welcome-content p, .reflection-content p {
        font-size: 1.1rem;
        line-height: 1.7;
        text-align: left;
        margin-bottom: 1.2rem;
      }
      
      .first-step-section {
        height: 50vh;
        min-height: 300px;
        padding: 2rem 1rem;
      }
      
      .first-step-content h2 {
        font-size: 2.2rem;
        padding: 0 1rem;
        line-height: 1.2;
      }
      
      .lodges-section {
        padding: 3rem 0;
      }
      
      .lodges-container {
        padding: 0 1.5rem;
      }
      
      .lodges-container h2 {
        font-size: 2.2rem;
        margin-bottom: 2.5rem;
      }
      
      .cta-button {
        padding: 1rem 2rem;
        font-size: 1.1rem;
        margin-top: 2rem;
        width: 100%;
        max-width: 300px;
        text-align: center;
      }
    }
    
    @media (max-width: 480px) {
      .hero-section {
        height: 100vh;
        min-height: 100vh;
        padding: 1.5rem 0.5rem;
      }
      
      .hero-logo {
        width: 200px;
        height: 200px;
        margin-bottom: 1rem;
      }
      
      .hero-text h1 {
        font-size: 1.8rem;
        line-height: 1.1;
      }
      
      .hero-text h2 {
        font-size: 1.2rem;
      }
      
      .welcome-section, .reflection-section {
        padding: 2.5rem 0;
      }
      
      .welcome-container, .reflection-container {
        gap: 2rem;
        padding: 0 1rem;
      }
      
      .welcome-image, .reflection-image {
        width: 100%;
        max-width: 300px;
      }
      
      .welcome-content h2, .reflection-content h2 {
        font-size: 1.8rem;
        margin-bottom: 1rem;
      }
      
      .welcome-content p, .reflection-content p {
        font-size: 1rem;
        line-height: 1.6;
        margin-bottom: 1rem;
      }
      
      .first-step-section {
        height: 40vh;
        min-height: 250px;
        padding: 1.5rem 0.5rem;
      }
      
      .first-step-content h2 {
        font-size: 1.8rem;
        padding: 0 0.5rem;
      }
      
      .lodges-section {
        padding: 2.5rem 0;
      }
      
      .lodges-container {
        padding: 0 1rem;
      }
      
      .lodges-container h2 {
        font-size: 1.8rem;
        margin-bottom: 2rem;
      }
      
      .cta-button {
        padding: 0.9rem 1.5rem;
        font-size: 1rem;
        margin-top: 1.5rem;
        max-width: 280px;
      }
    }
    
    @media (max-width: 360px) {
      .hero-section {
        height: 100vh;
        min-height: 100vh;
      }
      
      .hero-logo {
        width: 160px;
        height: 160px;
      }
      
      .hero-text h1 {
        font-size: 1.6rem;
      }
      
      .hero-text h2 {
        font-size: 1.1rem;
      }
      
      .welcome-content h2, .reflection-content h2 {
        font-size: 1.6rem;
      }
      
      .first-step-content h2 {
        font-size: 1.6rem;
      }
      
      .lodges-container h2 {
        font-size: 1.6rem;
      }
      
      .welcome-content p, .reflection-content p {
        font-size: 0.95rem;
      }
    }
  </style>
  
  <!-- Hero Section -->
  <section class="hero-section">
    <Image class="hero-background" src={templetUmea} alt="Umeå tempel" />
    <div class="hero-content">
      <Image class="hero-logo" src={distriktsSigill} alt="Distriktssigill" />
      <div class="hero-text">
        <h1>Fria och Antagna Murare</h1>
        <h2>Distriktet Sverige</h2>
      </div>
    </div>
  </section>

  <!-- Welcome Section -->
  <section class="welcome-section" style="background: #f8fafc; padding: 4rem 0; min-height: auto;">
    <div class="welcome-container" style="max-width: 1200px; margin: 0 auto; padding: 0 2rem; display: flex; align-items: flex-start; gap: 4rem; vertical-align: top;">
      <div class="welcome-image" style="flex: 1; text-align: center; display: flex; align-items: flex-start; justify-content: center;">
        <Image src={sections[0]?.imgLoader || solstavImage} alt="Frimureriskt kompass och vinkelhake" style="width: 100%; max-width: 600px; height: auto; border-radius: 1rem; box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1); object-fit: contain;" />
      </div>
      <div class="welcome-content" style="flex: 1;">
        <div style="color: #333; line-height: 1.8; font-size: 1.1rem;">
          {sections[0]?.Content && <sections[0].Content />}
        </div>
        {sections[0]?.linkUrl && (
          <a href={sections[0].linkUrl} style="background: #1a237e; color: white; padding: 1rem 2rem; border-radius: 2rem; text-decoration: none; font-weight: 600; font-size: 1.1rem; display: inline-block; margin-top: 2rem; transition: background 0.3s ease;" onmouseover="this.style.background='#3949ab'" onmouseout="this.style.background='#1a237e'">Vad Är Frimureri</a>
        )}
      </div>
    </div>
  </section>

  <!-- Reflection Section -->
  <section class="reflection-section" style="background: #fff; padding: 4rem 0; min-height: auto;">
    <div class="reflection-container" style="max-width: 1200px; margin: 0 auto; padding: 0 2rem; display: flex; align-items: flex-start; gap: 4rem; vertical-align: top;">
      <div class="reflection-content" style="flex: 1;">
        <div style="color: #333; line-height: 1.8; font-size: 1.1rem;">
          {sections[1]?.Content && <sections[1].Content />}
        </div>
        {sections[1]?.linkUrl && (
          <a href={sections[1].linkUrl} style="background: #1a237e; color: white; padding: 1rem 2rem; border-radius: 2rem; text-decoration: none; font-weight: 600; font-size: 1.1rem; display: inline-block; margin-top: 2rem; transition: background 0.3s ease;" onmouseover="this.style.background='#3949ab'" onmouseout="this.style.background='#1a237e'">Vill Du Bli Frimurare?</a>
        )}
      </div>
      <div class="reflection-image" style="flex: 1; text-align: center; display: flex; align-items: flex-start; justify-content: center;">
        <Image src={sections[1]?.imgLoader || manstavImage} alt="Frimureriskt kompass och vinkelhake" style="width: 100%; max-width: 600px; height: auto; border-radius: 1rem; box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1); object-fit: contain;" />
      </div>
    </div>
  </section>

  <!-- First Step Section -->
  <section class="first-step-section" style="position: relative; height: 60vh; display: flex; align-items: center; justify-content: center; overflow: hidden;">
    <Image class="first-step-background" src={templetUmea} alt="Umeå tempel" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: 1;" />
    <div class="first-step-content" style="position: relative; z-index: 2; text-align: center; color: white;">
      <h2 style="font-size: 3rem; font-weight: bold; margin: 0; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);">Allt börjar med ett första steg...</h2>
    </div>
  </section>

  <!-- Lodges Section -->
  <section class="lodges-section" style="background: #e3eaf3; padding: 4rem 0;">
    <div class="lodges-container" style="max-width: 1200px; margin: 0 auto; padding: 0 2rem; text-align: center;">
      <h2 style="color: #1a237e; font-size: 2.5rem; margin-bottom: 3rem; font-weight: 600;">Logerna i Sverige</h2>
      <LodgesGallery />
    </div>
  </section>
</MainLayout>
