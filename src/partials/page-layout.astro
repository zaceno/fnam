---
import { Image } from "astro:assets";
import { getCollection } from "astro:content";
import distriktsSigill from '../pages/_index_assets/Distriktsigill_frilagt-3.png'
import templetUmea from '../pages/_index_assets/Umea_tempel.png'
import loadContentImage from '../utils/load-content-image'

const { title, subtitle, image, showHero = true, imagePosition = 'right' } = Astro.props

// Get all articles for the related articles section
const allArticles = await getCollection('articles')
const relatedArticles = allArticles.filter(article => article.id !== title?.toLowerCase().replace(/\s+/g, '-')).slice(0, 3)
---

<div class="page-layout">
  {showHero && (
    <section class="page-hero">
      <Image class="page-hero-background" src={templetUmea} alt="Umeå tempel" />
      <div class="page-hero-content">
        <Image class="page-hero-logo inline" src={distriktsSigill} alt="Distriktssigill" />
        <div class="page-hero-text">
          <h1>{title}</h1>
          {subtitle && <h2>{subtitle}</h2>}
        </div>
      </div>
    </section>
  )}

  <main class="page-main">
    <div class="page-container">
      
      {image && imagePosition === 'top' && (
        <div class="page-image-section page-image-top">
          <div class="page-image-container">
            <Image src={loadContentImage(image)} alt={title} style="width: 100%; height: auto; border-radius: 0.5rem; object-fit: cover;" />
          </div>
        </div>
      )}
      
      <div class="page-main-content" style="display: flex; align-items: flex-start; gap: 4rem;">
        <div class="page-content" style="flex: 1;">
          <slot />
        </div>
        
        {image && imagePosition === 'right' && (
          <div class="page-image-section" style="flex: 1; text-align: center;">
            <div class="page-image-container">
              <Image src={loadContentImage(image)} alt={title} style="width: 100%; max-width: 500px; height: auto; border-radius: 1rem; box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1); object-fit: contain;" />
            </div>
            
            <!-- Related Articles Section - Right below the image -->
            {relatedArticles.length > 0 && (
              <div class="related-articles-section" style="margin-top: 2rem;">
                <h3 class="related-articles-title">Läs mer</h3>
                <div class="related-articles-grid">
                  {relatedArticles.map(article => (
                    <a href={`${import.meta.env.BASE_URL}/${article.id}`} class="related-article-card">
                      <div class="related-article-content">
                        <h4 class="related-article-title">{article.data.title}</h4>
                        <p class="related-article-excerpt">Klicka för att läsa mer om {article.data.title.toLowerCase()}</p>
                      </div>
                      <div class="related-article-arrow">→</div>
                    </a>
                  ))}
                </div>
              </div>
            )}
          </div>
        )}
      </div>
      
      {image && imagePosition === 'top' && relatedArticles.length > 0 && (
        <div class="related-articles-section related-articles-bottom">
          <h3 class="related-articles-title">Läs mer</h3>
          <div class="related-articles-grid">
            {relatedArticles.map(article => (
              <a href={`${import.meta.env.BASE_URL}/${article.id}`} class="related-article-card">
                <div class="related-article-content">
                  <h4 class="related-article-title">{article.data.title}</h4>
                  <p class="related-article-excerpt">Klicka för att läsa mer om {article.data.title.toLowerCase()}</p>
                </div>
                <div class="related-article-arrow">→</div>
              </a>
            ))}
          </div>
        </div>
      )}
    </div>
  </main>
</div>

<style>
  /* Global mobile fixes */
  html, body {
    width: 100%;
    min-height: 100vh;
    overflow-x: hidden;
  }
  
  .page-layout {
    min-height: 100vh;
    width: 100%;
  }

  /* Page Hero Section */
  .page-hero {
    position: relative;
    width: 100%;
    height: 50vh;
    min-height: 400px;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
  }

  .page-hero-background {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    z-index: 1;
  }

  .page-hero-content {
    position: relative;
    z-index: 2;
    text-align: center;
    color: white;
  }

  .page-hero-logo {
    width: 150px;
    height: 150px;
    border-radius: 50%;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
    background: #fff;
    padding: 1rem;
    object-fit: contain;
    margin-bottom: 1.5rem;
  }

  .page-hero-text h1 {
    font-size: 2.5rem;
    font-weight: bold;
    margin: 0;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
  }

  .page-hero-text h2 {
    font-size: 1.5rem;
    font-weight: 300;
    margin: 0.5rem 0 0 0;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
  }

  /* Page Main Content */
  .page-main {
    background: #f8fafc;
    min-height: 50vh;
  }

  .page-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 1rem 2rem;
  }

  .page-header {
    text-align: center;
    margin-bottom: 3rem;
  }

  .page-header h1 {
    color: #1a237e;
    font-size: 2.5rem;
    font-weight: 600;
    margin-bottom: 1rem;
  }

  .page-header h2 {
    color: #666;
    font-size: 1.5rem;
    font-weight: 300;
    margin: 0;
  }

  .page-image-section {
    padding: 0;
    background: none;
    border-radius: 0;
  }

  .page-image-container {
    max-width: 100%;
    margin: 0;
    text-align: center;
    padding: 0;
  }

  .page-image-container img {
    max-width: 100%;
    height: auto;
    border-radius: 1rem;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s ease;
  }

  .page-image-container img:hover {
    transform: scale(1.02);
  }

  /* Top image positioning */
  .page-image-top {
    text-align: center;
    margin: 0 0 1rem 0;
  }

  .page-image-top .page-image-container {
    max-width: 100%;
    margin: 0 auto;
    text-align: center;
  }

  /* Bottom related articles */
  .related-articles-bottom {
    margin-top: 3rem;
  }

  .page-content {
    background: white;
    border-radius: 1rem;
    padding: 3rem;
    box-shadow: 0 2px 16px rgba(0, 0, 0, 0.1);
    line-height: 1.8;
  }


  .page-content h1,
  .page-content h2,
  .page-content h3,
  .page-content h4 {
    color: #1a237e;
    margin-top: 2rem;
    margin-bottom: 1rem;
  }

  .page-content h1 {
    font-size: 2rem;
    border-bottom: 2px solid #e3eaf3;
    padding-bottom: 0.5rem;
  }

  .page-content h2 {
    font-size: 1.5rem;
  }

  .page-content h3 {
    font-size: 1.25rem;
  }

  .page-content p {
    margin-bottom: 1.5rem;
    color: #333;
  }

  .page-content ul,
  .page-content ol {
    margin-bottom: 1.5rem;
    padding-left: 2rem;
  }

  .page-content li {
    margin-bottom: 0.5rem;
  }

  .page-content blockquote {
    border-left: 4px solid #1a237e;
    padding-left: 1.5rem;
    margin: 2rem 0;
    font-style: italic;
    color: #666;
  }

  .page-content a {
    color: #1a237e;
    text-decoration: none;
    font-weight: 500;
  }

  .page-content a:hover {
    color: #3949ab;
    text-decoration: underline;
  }

  /* Related Articles Section */
  .related-articles-section {
    margin-top: 2rem;
    padding: 2rem;
    background: linear-gradient(135deg, #f8fafc 0%, #e3eaf3 100%);
    border-radius: 1rem;
  }

  .related-articles-title {
    color: #1a237e;
    font-size: 1.5rem;
    font-weight: 600;
    text-align: center;
    margin-bottom: 1.5rem;
  }

  .related-articles-grid {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .related-article-card {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: white;
    border-radius: 1rem;
    padding: 1.5rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    text-decoration: none;
    color: inherit;
    transition: all 0.3s ease;
    border: 2px solid transparent;
  }

  .related-article-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
    border-color: #1a237e;
  }

  .related-article-content {
    flex: 1;
  }

  .related-article-title {
    color: #1a237e;
    font-size: 1.2rem;
    font-weight: 600;
    margin: 0 0 0.5rem 0;
  }

  .related-article-excerpt {
    color: #666;
    font-size: 0.9rem;
    margin: 0;
    line-height: 1.4;
  }

  .related-article-arrow {
    color: #1a237e;
    font-size: 1.5rem;
    font-weight: bold;
    margin-left: 1rem;
    transition: transform 0.3s ease;
  }

  .related-article-card:hover .related-article-arrow {
    transform: translateX(4px);
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .page-hero {
      height: 50vh;
      min-height: 300px;
      padding: 2rem 1rem;
    }
    
    .page-main {
      width: 100%;
    }
    
    .page-container {
      width: 100%;
      margin: 0;
      padding: 0 1rem;
    }
    
    .page-main-content {
      flex-direction: column !important;
      gap: 2rem !important;
    }
    
    .page-image-section {
      width: 100%;
      margin: 0;
      padding: 0;
      order: 1;
    }

    .page-image-top {
      margin: 0 0 0.5rem 0;
    }

    .page-image-top .page-image-container {
      padding: 2rem 1.5rem;
    }
    
    .page-content {
      order: 2;
      padding: 2.5rem 2rem;
    }

    
    .related-articles-section {
      margin-top: 1.5rem;
      padding: 1.5rem;
    }

    .related-articles-bottom {
      margin-top: 2rem;
    }
    
    .related-articles-title {
      font-size: 1.3rem;
      margin-bottom: 1rem;
    }
    
    .related-article-card {
      padding: 1rem;
    }
    
    .related-article-title {
      font-size: 1rem;
    }
    
    .related-article-excerpt {
      font-size: 0.8rem;
    }

    .page-hero-logo {
      width: 120px;
      height: 120px;
      margin-bottom: 1.5rem;
    }

    .page-hero-text h1 {
      font-size: 2rem;
      line-height: 1.2;
    }

    .page-hero-text h2 {
      font-size: 1.3rem;
    }

    .page-container {
      padding: 0.5rem 1rem;
    }

    .page-content {
      padding: 0;
    }

    .page-header h1 {
      font-size: 2rem;
    }

    .page-header h2 {
      font-size: 1.3rem;
    }

    .page-image-section {
      margin-bottom: 1.5rem;
      padding: 2.5rem 0;
    }

    .page-image-container {
      padding: 0 1.5rem;
    }
  }

  @media (max-width: 480px) {
    .page-hero {
      height: 45vh;
      min-height: 250px;
      padding: 1.5rem 0.5rem;
    }

    .page-hero-logo {
      width: 100px;
      height: 100px;
      margin-bottom: 1rem;
    }

    .page-hero-text h1 {
      font-size: 1.7rem;
      line-height: 1.1;
    }

    .page-hero-text h2 {
      font-size: 1.1rem;
    }

    .page-container {
      padding: 0.5rem 1rem;
    }

    .page-content {
      padding: 2rem 1.5rem;
    }


    .page-header h1 {
      font-size: 1.7rem;
    }

    .page-header h2 {
      font-size: 1.1rem;
    }

    .page-content h1 {
      font-size: 1.7rem;
    }

    .page-content h2 {
      font-size: 1.4rem;
    }

    .page-content h3 {
      font-size: 1.2rem;
    }

    .page-image-section {
      margin-bottom: 1rem;
      padding: 2rem 0;
    }

    .page-image-container {
      padding: 0 1rem;
    }

    .page-image-top .page-image-container {
      padding: 1.5rem 1rem;
    }
  }

  @media (max-width: 360px) {
    .page-hero {
      height: 40vh;
      min-height: 200px;
    }

    .page-hero-logo {
      width: 80px;
      height: 80px;
    }

    .page-hero-text h1 {
      font-size: 1.5rem;
    }

    .page-hero-text h2 {
      font-size: 1rem;
    }

    .page-container {
      padding: 0.5rem 0.5rem;
    }

    .page-content {
      padding: 1.5rem 1rem;
    }


    .page-header h1 {
      font-size: 1.5rem;
    }

    .page-header h2 {
      font-size: 1rem;
    }

    .page-content h1 {
      font-size: 1.5rem;
    }

    .page-content h2 {
      font-size: 1.3rem;
    }

    .page-content h3 {
      font-size: 1.1rem;
    }
  }
</style>
